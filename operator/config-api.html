<html><head><title>VinylDNS: API Configuration Guide</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="VinylDNS" /><meta name="description" content="DNS Management Platform" /><meta name="og:image" content="/img/poster.png" /><meta name="og:title" content="VinylDNS: API Configuration Guide" /><meta name="og:site_name" content="VinylDNS" /><meta name="og:url" content="http://vinyldns.io" /><meta name="og:type" content="website" /><meta name="og:description" content="DNS Management Platform" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="VinylDNS: API Configuration Guide" /><meta name="twitter:image" content="http://vinyldns.ioimg/poster.png" /><meta name="twitter:description" content="DNS Management Platform" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/default.css" /><link rel="stylesheet" href="/css/style.css" /><link rel="stylesheet" href="/css/palette.css" /><link rel="stylesheet" href="/css/codemirror.css" /><link rel="stylesheet" href="/css/custom.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>VinylDNS</span></div></a></li>       <li><a href="/operator/index.html" class="">Operator Guide</a></li> <li><a href="/operator/pre" class="">Pre-requisites</a> <ul class="sub_section"> <li><a href="/operator/setup-dynamodb" class="">Setup AWS DynamoDB</a></li> <li><a href="/operator/setup-mysql" class="">Setup MySQL</a></li> <li><a href="/operator/setup-sqs" class="">Setup AWS SQS</a></li> <li><a href="/operator/setup-ldap" class="">Setup LDAP</a></li></ul></li> <li><a href="/operator/setup-api" class="">Setup API Server</a> <ul class="sub_section"> <li><a href="/operator/config-api" class=" active ">API Configuration Guide</a></li></ul></li> <li><a href="/operator/setup-portal" class="">Setup the Portal Server</a> <ul class="sub_section"> <li><a href="/operator/config-portal" class="">Portal Configuration Guide</a></li></ul></li>      </ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/VinylDNS/vinyldns"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/VinylDNS/vinyldns"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="VinylDNS" data-github-repo="vinyldns"><div class="content-wrapper"><section><h1 id="api-configuration-guide">API Configuration Guide</h1>

<p><strong>Note: ALL configuration assumes a <code class="highlighter-rouge">vinyldns</code> namespace.  For example, sqs settings would be under <code class="highlighter-rouge">vinyldns.sqs</code>.</strong></p>

<h2 id="configuration">Configuration</h2>
<ul>
  <li><a href="#configuration-overview">Configuration Overview</a></li>
  <li><a href="#configuring-api-server">Configuration API Server</a></li>
  <li><a href="#queue-configuration">Queue Configuration</a></li>
  <li><a href="#database-configuration">Database Configuration</a></li>
  <li><a href="#cryptography-settings">Cryptography</a></li>
  <li><a href="#additional-configuration-settings">Additional Configuration Settings</a></li>
  <li><a href="#full-example-config">Full Example Config</a></li>
</ul>

<p>There are a lot of configuration settings in VinylDNS.  So much so that it may seem overwhelming to configure
vinyldns to your environment.  This document describes the configuration settings, highlighting the settings
you are <em>most likely to change</em>.  All of the configuration settings are captured at the end.</p>

<p>It is important to note that the <code class="highlighter-rouge">api</code> and <code class="highlighter-rouge">portal</code> have <em>different</em> configuration.  We will review the configuration
for each separately.</p>

<h2 id="configuration-overview">Configuration Overview</h2>

<h3 id="how-do-we-config">How do we config?</h3>
<p>All configuration is done using <a href="https://github.com/lightbend/config">Typesafe Config</a>.  It provides a means to
specifying default configurations, and overriding the configured values in a number of ways:</p>

<ol>
  <li>The <em>default</em> configuration provides “safe” default values for all configuration.  This makes it possible for you
to only change the configuration values that you <em>need</em> to, and assume the <em>default</em> for the rest.  This can
typically be found in a file named <code class="highlighter-rouge">reference.conf</code>.  The Typesafe Config library manages populating unspecified values
for you automatically.</li>
  <li>You can override the <code class="highlighter-rouge">reference.conf</code> file by providing your own <code class="highlighter-rouge">application.conf</code> file when the system starts up.
We will review how to do that in the sections that follow.</li>
  <li>You can override <em>individual</em> configuration properties when the application starts up using standard jvm arguments.
For example, you can specify <code class="highlighter-rouge">-Dmy.config.value=42</code>, and that will override <em>both</em> application.conf <em>and</em> reference.conf (defaults)</li>
  <li>You can further override configuration properties with <em>environment variables</em>.  The Typesafe Config provides special
syntax that allows you to use environment variables.  You can make the environment variable optional (meaning use it if it is there)
or required (fail to start up without the environment variable).  We will illustrate use of environment variables in this guide.</li>
</ol>

<h3 id="using-environment-variables">Using Environment Variables</h3>
<p>We <em>strongly</em> recommend that you use environment variables in particular for secrets.  Laying down environment variables
in a flat file is a security vulnerability for your installation.  To demonstrate environment variable usage, here is a following
snippet…</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code>  <span class="s">queue.settings {</span>
    <span class="s">access-key = ${AWS_ACCESS_KEY}</span>
    <span class="s">secret-key = ${AWS_SECRET_ACCESS_KEY}</span>
    <span class="s">signing-region = ${SQS_REGION}</span>
    <span class="s">service-endpoint = ${SQS_ENDPOINT}</span>
    <span class="s">queue-name = ${SQS_QUEUE_NAME}</span>
  <span class="s">}</span>
</code></pre>
</div>

<p>In the example, if any of the values in <code class="highlighter-rouge">${xxx}</code> are not found in the environment, the application will not start up!</p>

<h2 id="configuring-api-server">Configuring API Server</h2>
<p>The API configuration has a lot of values, the important ones reviewed here.  There are several configuration
settings that are specific to <em>your</em> environment.</p>

<p>The most important configuration is around your system dependencies. Presently, these are your settings for:</p>
<ul>
  <li><code class="highlighter-rouge">AWS SQS</code></li>
  <li><code class="highlighter-rouge">AWS DynamoDB</code></li>
  <li><code class="highlighter-rouge">MySQL</code></li>
</ul>

<p><strong>We are actively working on supporting different message queues and data stores.  Look for those to become available shortly</strong></p>

<h2 id="queue-configuration">Queue Configuration</h2>
<p>VinylDNS supports both SQS and MySQL queue implementations.</p>

<p>There are a couple of implementation-dependent settings that need to be specified:</p>
<ul>
  <li><code class="highlighter-rouge">messages-per-poll</code>: Number of messages retrieved in a single queue receive request. Valid values are 1 through 10 (default).</li>
  <li><code class="highlighter-rouge">polling-interval</code>: Interval to delay between each poll for messages.</li>
</ul>

<p>If using SQS, be sure to follow the <a href="setup-sqs">AWS SQS Setup Guide</a> first to get the values you need to configure here.</p>

<p>If using MySQL, follow the <a href="setup-mysql">MySQL Setup Guide</a> first to get the values you need to configure here.</p>

<p>The following in a sample SQS config:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">vinyldns {</span>

  <span class="s">queue {</span>
    <span class="s">class-name = "vinyldns.sqs.queue.SqsMessageQueueProvider"</span>

    <span class="s">messages-per-poll = 10</span>
    <span class="s">polling-interval = 250.millis</span>
    
    <span class="s"># connection information to SQS</span>
    <span class="s">settings {</span>
      <span class="s"># AWS access key and secret.</span>
      <span class="s">access-key = "x"</span>
      <span class="s">secret-key = "x"</span>
      
      <span class="s"># Regional endpoint to make your requests (eg. 'us-west-2', 'us-east-1', etc.). This is the region where your queue is housed.</span>
      <span class="s">signing-region = "x"</span>
      
      <span class="s"># Endpoint to access queue</span>
      <span class="s">service-endpoint = "http://vinyldns-elasticmq:9324/"</span>
      
      <span class="s"># Queue name. Should be used in conjunction with service endpoint, rather than using a queue url which is subject to change.</span>
      <span class="s">queue-name = "vinyldns"</span>
    <span class="s">}</span>
  <span class="s">}</span>
<span class="err">}</span>
</code></pre>
</div>

<p>The following is a sample MySQL queue config:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">queue {</span>
  <span class="s">class-name = "vinyldns.mysql.queue.MySqlMessageQueueProvider"</span>
  
  <span class="s">polling-interval = 250.millis</span>
  <span class="s">messages-per-poll = 10</span>

  <span class="s">settings = {</span>
    <span class="s">name = "vinyldns"</span>
    <span class="s">driver = "org.mariadb.jdbc.Driver"</span>
    <span class="s">migration-url = "jdbc:mariadb://localhost:19004/?user=root&amp;password=pass"</span>
    <span class="s">url = "jdbc:mariadb://localhost:19004/vinyldns?user=root&amp;password=pass"</span>
    <span class="s">user = "root"</span>
    <span class="s">password = "pass"</span>

    <span class="s"># see https://github.com/brettwooldridge/HikariCP</span>
    <span class="s">connection-timeout-millis = 1000</span>
    <span class="s">idle-timeout = 10000</span>
    <span class="s">max-lifetime = 30000</span>
    <span class="s">maximum-pool-size = 5</span>
    <span class="s">minimum-idle = 0</span>

    <span class="s">my-sql-properties = {</span>
      <span class="s">cachePrepStmts=true</span>
      <span class="s">prepStmtCacheSize=250</span>
      <span class="s">prepStmtCacheSqlLimit=2048</span>
      <span class="s">rewriteBatchedStatements=true</span>
    <span class="s">}</span>
  <span class="s">}</span>
<span class="err">}</span>
</code></pre>
</div>

<h2 id="database-configuration">Database Configuration</h2>
<p>VinylDNS supports both DynamoDB and MySQL backends. You can enable all repos in a single backend, or have a mix of the two.
For each backend, you need to configure the table(s) that should be loaded.</p>

<p>You must have all of the following required API repositories configured in exactly one datastore.
<strong>Some repositories are implemented in DynamoDB, all repositories have MySQL support</strong>:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Repository</th>
      <th style="text-align: center">DynamoDB support</th>
      <th style="text-align: center">MySQL support</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">BatchChange</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">X</td>
    </tr>
    <tr>
      <td style="text-align: left">Group</td>
      <td style="text-align: center">X</td>
      <td style="text-align: center">X</td>
    </tr>
    <tr>
      <td style="text-align: left">GroupChange</td>
      <td style="text-align: center">X</td>
      <td style="text-align: center">X</td>
    </tr>
    <tr>
      <td style="text-align: left">Membership</td>
      <td style="text-align: center">X</td>
      <td style="text-align: center">X</td>
    </tr>
    <tr>
      <td style="text-align: left">RecordSet</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">X</td>
    </tr>
    <tr>
      <td style="text-align: left">RecordSetChange</td>
      <td style="text-align: center">X</td>
      <td style="text-align: center">X</td>
    </tr>
    <tr>
      <td style="text-align: left">User</td>
      <td style="text-align: center">X</td>
      <td style="text-align: center">X</td>
    </tr>
    <tr>
      <td style="text-align: left">UserChange</td>
      <td style="text-align: center">X</td>
      <td style="text-align: center">X</td>
    </tr>
    <tr>
      <td style="text-align: left">Zone</td>
      <td style="text-align: center"> </td>
      <td style="text-align: center">X</td>
    </tr>
    <tr>
      <td style="text-align: left">ZoneChange</td>
      <td style="text-align: center">X</td>
      <td style="text-align: center">X</td>
    </tr>
  </tbody>
</table>

<p>If using MySQL, follow the <a href="setup-mysql">MySQL Setup Guide</a> first to get the values you need to configure here.</p>

<p>If using DynamoDB, follow the <a href="setup-dynamodb">AWS DynamoDB Setup Guide</a> first to get the values you need to configure here.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">vinyldns {</span>

  <span class="s"># this list should include only the datastores being used by your instance</span>
  <span class="s">data-stores = ["mysql", "dynamodb"]</span>
  
  <span class="s">mysql {</span>
    
    <span class="s"># this is the path to the mysql provider. This should not be edited</span>
    <span class="s"># from the default in reference.conf</span>
    <span class="s">class-name = "vinyldns.mysql.repository.MySqlDataStoreProvider"</span>
    
    <span class="s">settings {</span>
      <span class="s"># the name of the database, recommend to leave this as is</span>
      <span class="s">name = "vinyldns"</span>
      
      <span class="s"># the jdbc driver, recommended to leave this as is</span>
      <span class="s">driver = "org.mariadb.jdbc.Driver"</span>
  
      <span class="s"># the URL used to create the schema, typically this will be without the "database" name</span>
      <span class="s">migration-url = "jdbc:mariadb://localhost:19002/?user=root&amp;password=pass"</span>
  
      <span class="s"># the main connection URL</span>
      <span class="s">url = "jdbc:mariadb://localhost:19002/vinyldns?user=root&amp;password=pass"</span>
  
      <span class="s"># the user to connect to MySQL</span>
      <span class="s">user = "root"</span>
  
      <span class="s"># the password to connect to MySQL</span>
      <span class="s">password = "pass"</span>
  
      <span class="s">## see https://github.com/brettwooldridge/HikariCP for more detail on the following fields</span>
      <span class="s"># the maximum number of connections to scale the connection pool to</span>
      <span class="s">maximum-pool-size = 20</span>
  
      <span class="s"># the maximum number of milliseconds to wait for a connection from the connection pool</span>
      <span class="s">connection-timeout-millis = 1000</span>
      
      <span class="s"># the minimum number of idle connections that HikariCP tries to maintain in the pool</span>
      <span class="s">minimum-idle = 10</span>
            
      <span class="s"># the maximum number of milliseconds that a connection is can sit idle in the pool</span>
      <span class="s">idle-timeout = 10000</span>
  
      <span class="s"># The max lifetime of a connection in a pool.  Should be several seconds shorter than the database imposed connection time limit</span>
      <span class="s">max-lifetime = 600000</span>
      
      <span class="s"># controls whether JMX MBeans are registered</span>
      <span class="s">register-mbeans = true</span>
      
      <span class="s"># my-sql-properties allows you to include any additional mysql performance settings you want.</span>
      <span class="s"># Note that the properties within my-sql-properties must be camel case!</span>
      <span class="s"># see https://github.com/brettwooldridge/HikariCP/wiki/MySQL-Configuration for guidance</span>
      <span class="s">my-sql-properties {</span>
        <span class="s">prepStmtCacheSize = 300</span>
        <span class="s">prepStmtCacheSqlLimit = 2048</span>
        <span class="s">cachePrepStmts = true</span>
        <span class="s">useServerPrepStmts = true</span>
        <span class="s">rewriteBatchedStatements = true</span>
      <span class="s">}</span>
    <span class="s">}</span>
    
    <span class="s">repositories {</span>
      <span class="s"># all repositories with config sections here will be enabled in mysql</span>
      <span class="s">zone {</span>
        <span class="s"># no additional settings for repositories enabled in mysql</span>
      <span class="s">}</span>
      <span class="s">batch-change {</span>
      <span class="s">}</span>
      <span class="s">user {</span>
      <span class="s">}</span>
      <span class="s">record-set {</span>
      <span class="s">}</span>
    <span class="s">}</span>
  <span class="s">}</span>
  
  <span class="s">dynamodb {</span>
      
    <span class="s"># this is the path to the DynamoDB provider. This should not be edited</span>
    <span class="s"># from the default in reference.conf</span>
    <span class="s">class-name = "vinyldns.dynamodb.repository.DynamoDBDataStoreProvider"</span>
    
    <span class="s">settings {</span>
      <span class="s"># AWS_ACCESS_KEY, credential needed to access the SQS queue</span>
      <span class="s">key = "x"</span>
    
      <span class="s"># AWS_SECRET_ACCESS_KEY, credential needed to access the SQS queue</span>
      <span class="s">secret = "x"</span>
    
      <span class="s"># DynamoDB url for the region you are running in, this example is in us-east-1</span>
      <span class="s">endpoint = "https://dynamodb.us-east-1.amazonaws.com"</span>
      
      <span class="s"># DynamoDB region</span>
      <span class="s">region = "us-east-1"</span>
    <span class="s">}</span>
    
    <span class="s">repositories {</span>
      <span class="s"># all repositories with config sections here will be enabled in dynamodb</span>
      <span class="s">record-change {</span>
        <span class="s"># Name of the table where recordsets are saved</span>
        <span class="s">table-name = "recordChangeTest"</span>
        <span class="s"># Provisioned throughput for reads</span>
        <span class="s">provisioned-reads = 30</span>
        <span class="s"># Provisioned throughput for writes</span>
        <span class="s">provisioned-writes = 20</span>
      <span class="s">}</span>
      <span class="s">zone-change {</span>
        <span class="s">table-name = "zoneChangesTest"</span>
        <span class="s">provisioned-reads = 30</span>
        <span class="s">provisioned-writes = 20</span>
      <span class="s">}</span>
      <span class="s">group {</span>
        <span class="s">table-name = "groupsTest"</span>
        <span class="s">provisioned-reads = 30</span>
        <span class="s">provisioned-writes = 20</span>
      <span class="s">}</span>
      <span class="s">group-change {</span>
        <span class="s">table-name = "groupChangesTest"</span>
        <span class="s">provisioned-reads = 30</span>
        <span class="s">provisioned-writes = 20</span>
      <span class="s">}</span>
      <span class="s">membership {</span>
        <span class="s">table-name = "membershipTest"</span>
        <span class="s">provisioned-reads = 30</span>
        <span class="s">provisioned-writes = 20</span>
      <span class="s">}</span>
    <span class="s">}</span>
  <span class="s">}</span>
<span class="err">}</span>
</code></pre>
</div>

<h2 id="cryptography-settings">Cryptography Settings</h2>
<p>VinylDNS uses symmetric cryptography in order to encrypt/decrypt sensitive information in the system.  This includes
TSIG keys and user secrets.  Cryptography is used in <em>both</em> the portal as well as the api.</p>

<p>Cryptography is <em>pluggable</em>, meaning you can bring your own crypto with you.  All that is required is to provide an
implementation of <a href="https://github.com/vinyldns/vinyldns/blob/master/modules/core/src/main/scala/vinyldns/core/crypto/CryptoAlgebra.scala">CryptoAlgebra</a>
using a crypto library of choice.  The default implementation is <code class="highlighter-rouge">NoOpCrypto</code>, which does not do any encryption (not recommended for production).
VinylDNS provides a cryptography implementation called <code class="highlighter-rouge">JavaCrypto</code> that you can use for production.  The example that follows illustrates
using the provided <code class="highlighter-rouge">JavaCrypto</code>.</p>

<p>If you create your own implementation, you have to build your jar and make it (and all dependencies) available to the VinylDNS API
and the VinylDNS portal.</p>

<p>The following are the configuration settings for crypto.  Notice here the <em>only</em> thing we see is the <code class="highlighter-rouge">type</code>.  The <code class="highlighter-rouge">type</code>
is the fully qualified class name for the <code class="highlighter-rouge">CryptoAlgebra</code> you will be using.  If your crypto implementation requires
additional settings, they will be configured inside the <code class="highlighter-rouge">crypto</code> element, adjacent to the <code class="highlighter-rouge">type</code>.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">vinyldns {</span>
  <span class="s">crypto {</span>
    <span class="s">type = "vinyldns.core.crypto.JavaCrypto"</span>
    <span class="s">secret = "8B06A7F3BC8A2497736F1916A123AA40E88217BE9264D8872597EF7A6E5DCE61"</span>
  <span class="s">}</span>
<span class="err">}</span>
</code></pre>
</div>

<h2 id="default-zone-connections">Default Zone Connections</h2>
<p>VinylDNS has three ways of indicating zone connections:</p>

<ol>
  <li>Global default connection applies to all zones unless overridden by one of the following connections. This configuration is required.</li>
  <li>Backends allows you to specify zone connection information for an individual zone by choosing a pre-configured zone connection. This configuration is optional.</li>
  <li>Zone level override allows you to specify zone update and transfer connection information <em>for each zone</em>. More information is in the <a href="../api/zone-model">Zone Model</a>.</li>
</ol>

<p>VinylDNS has <strong>2</strong> connections for each zone:</p>

<ol>
  <li>The DDNS connection - used for making DDNS updates to the zone</li>
  <li>The Transfer connection - used for making AXFR requests for zone syncing with the DNS backend</li>
</ol>

<p>VinylDNS also ties in testing network connectivity to the default zone connection’s primary server into its API health checks. A value
for the health check connection timeout in milliseconds can be specified using <code class="highlighter-rouge">health-check-timeout</code>; a default value of 10000 will
be used if not provided.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">vinyldns {</span>

    <span class="s"># timeout for DNS backend connectivity health check</span>
    <span class="s">health-check-timeout = 5000</span>

  <span class="s"># the DDNS connection information for the default dns backend</span>
  <span class="s">defaultZoneConnection {</span>
    <span class="s"># this is not really used, but must be set, usually set to the keyName itself, or a descriptive name if you are interested</span>
    <span class="s">name = "vinyldns."</span>

    <span class="s"># the name of the TSIG key</span>
    <span class="s">keyName = "vinyldns."</span>

    <span class="s"># the TSIG secret key</span>
    <span class="s">key = "nzisn+4G2ldMn0q1CV3vsg=="</span>

    <span class="s"># the host name or IP address, note you can add a port if not using the default by settings hostname:port</span>
    <span class="s">primaryServer = "ddns1.foo.bar.com"</span>
  <span class="s">}</span>

  <span class="s"># the AXFR connection information for the default dns backend</span>
  <span class="s">defaultTransferConnection {</span>
    <span class="s">name = "vinyldns."</span>
    <span class="s">keyName = "vinyldns."</span>
    <span class="s">key = "nzisn+4G2ldMn0q1CV3vsg=="</span>
    <span class="s">primaryServer = "vinyldns-bind9"</span>
  <span class="s">}</span>
<span class="err">}</span>

<span class="c1"># Zone Connection Data, ID can be specified in a zone to override the global default configuration</span>
<span class="s">backends = [</span>
    <span class="s">{</span>
      <span class="s">id = "test-backend-id"</span>
      <span class="s">zone-connection {</span>
        <span class="s">name = "vinyldns."</span>
        <span class="s">key-name = "vinyldns."</span>
        <span class="s">key = "nzisn+4G2ldMn0q1CV3vsg=="</span>
        <span class="s">primary-server = "127.0.0.1:19001"</span>
      <span class="s">}</span>
      <span class="s">transfer-connection {</span>
        <span class="s">name = "vinyldns."</span>
        <span class="s">key-name = "vinyldns."</span>
        <span class="s">key = "nzisn+4G2ldMn0q1CV3vsg=="</span>
        <span class="s">primary-server = "127.0.0.1:19001"</span>
      <span class="s">}</span>
    <span class="s">}</span>
<span class="err">]</span>
</code></pre>
</div>

<h2 id="additional-configuration-settings">Additional Configuration Settings</h2>

<h3 id="approved-name-servers">Approved Name Servers</h3>
<p>When running a large DNS installation, allowing users the ability to self-manage zone delegations can lead to a lot
of problems when not done properly.  Also, allowing delegation to untrusted DNS servers can be a security risk.</p>

<p>To “lock down” zone delegation, you can configure name servers that you trust, so zone delegation is controlled.</p>

<p>The entries in the list can be host names, IP addresses, or regular expressions.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">approved-name-servers = [</span>
  <span class="s">"172.17.42.1.",</span>
  <span class="s">"ddns1.foo.bar.",</span>
  <span class="s">".*awsdns.*"</span>
<span class="err">]</span>
</code></pre>
</div>

<h3 id="processing-disabled">Processing Disabled</h3>
<p>The processing disabled flag can be used if doing a blue/green deployment.  When processing is disabled, the
VinylDNS engine will <em>not</em> be actively polling the message queue for messages.</p>

<p><code class="highlighter-rouge">processing-disabled = false | true</code></p>

<h3 id="color">Color</h3>
<p>For blue-green deployments, you can configure the color of the current node.  Not applicable to every environment.</p>

<p><code class="highlighter-rouge">color = "green"</code></p>

<h3 id="version">Version</h3>
<p>Version of the application that is deployed.  Currently, this is a configuration value.</p>

<p><code class="highlighter-rouge">version = "0.8.0"</code></p>

<p><strong>Note: You can get installation information including color, version, default key name, and processing-disabled by hitting the <em>status</em> endpoint GET /status</strong></p>

<h3 id="http-host-and-port">HTTP Host and Port</h3>
<p>To specify what host and port to bind to when starting up the API server, default is 9000.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">rest {</span>
  <span class="s">host = "0.0.0.0"</span>
  <span class="s">port = 9000</span>
<span class="err">}</span>
</code></pre>
</div>

<h3 id="sync-delay">Sync Delay</h3>
<p>VinylDNS uses a “sync-delay” setting that prevents users from syncing their zones too frequently.  The settings is
inspected <em>per zone</em>, and is the number of milliseconds since the <em>last</em> sync to wait before allowing another sync for
<em>that</em> zone.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">sync-delay = 10000</span>
</code></pre>
</div>

<h3 id="notifiers">Notifiers</h3>
<p>VinylDNS provides the ability to send notifications via configured notifiers when a batch change is either implemented
or rejected. Notifiers in VinylDNS are designed to be pluggable (ie. bring-your-own-implementation), granting users the 
flexibility to implement their own which can smoothly integrate into their instance.</p>

<p>Setup requires a <code class="highlighter-rouge">notifiers</code> key which contains all of the configured notifiers that will be used by the running
instance.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">notifiers = ["email", "sns"]</span>
</code></pre>
</div>

<h4 id="e-mail-notifier">E-mail notifier</h4>
<p>Configuration for the e-mail notifier appears like the following:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">email = {</span>
  <span class="s"># Path to notifier provider implementation</span>
  <span class="s">class-name = "vinyldns.api.notifier.email.EmailNotifierProvider"</span>
  
  <span class="s">settings = {</span>
    <span class="s"># Sender address for e-mail notifications</span>
    <span class="s">from = "Sender &lt;do-not-reply@example.sender&gt;"</span>

    <span class="s">smtp {</span>
      <span class="s"># Host SMTP server</span>
      <span class="s">host = "example.host"</span>
  <span class="s">}</span>
<span class="err">}</span>
</code></pre>
</div>

<p>Note that <code class="highlighter-rouge">settings.from</code> and <code class="highlighter-rouge">settings.smtp</code> are both required, though the <code class="highlighter-rouge">smtp</code> values requirements depend on the specific
exchange service that you are interfacing with.</p>

<p>Below is an example e-mail notification:</p>

<p><img src="../img/sample-email-nofitication.png" alt="Sample E-mail Notification" /></p>

<h4 id="awd-simple-notification-service-sns-notifier">AWD Simple Notification Service (SNS) notifier</h4>
<p>Configuration for the AWS SNS notifier appears like the following:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">sns {</span>
  <span class="s"># Path to notifier provider implementation</span>
  <span class="s">class-name = "vinyldns.api.notifier.sns.SnsNotifierProvider"</span>
  
  <span class="s">settings {</span>
    <span class="s"># SNS topic Amazon Resource Name (ARN)</span>
    <span class="s">topic-arn = "arn:aws:sns:us-east-1:000000000000:batchChanges"</span>
    
    <span class="s"># AWS access key and secret</span>
    <span class="s">access-key = "vinyldnsTest"</span>
    <span class="s">secret-key = "notNeededForSnsLocal"</span>
    
    <span class="s"># Endpoint to access SNS</span>
    <span class="s">service-endpoint = "http://127.0.0.1:19006"</span>
    
    <span class="s"># Regional endpoint to make your requests (eg. 'us-west-2', 'us-east-1', etc.). This is the region where your SNS is housed.</span>
    <span class="s">signing-region = "us-east-1"</span>
  <span class="s">}</span>
<span class="err">}</span>

<span class="c1">### Batch Manual Review Enabled &lt;a id="manual-review" /&gt;</span>
<span class="s">Configuration setting that determines whether batch changes with non-fatal errors can be reviewed rather than failing immediately.</span>
<span class="s">When enabling manual review, the expectation is that a DNS technician is actively querying and addressing batch change</span>
<span class="s">requests that are in a manual review state. If your process flow does not accommodate this expectation, we advise disabling</span>
<span class="s">manual review.</span>

<span class="err">```</span><span class="s">yaml</span>
<span class="s">manual-batch-review-enabled = true</span>
</code></pre>
</div>

<h3 id="manual-review-domains">Manual Review Domains</h3>
<p>Configuration setting that determines what Batch Change/DNS Change input names require manual review if <code class="highlighter-rouge">manual-batch-review-enabled</code> is set to <code class="highlighter-rouge">true</code>.
If <code class="highlighter-rouge">manual-batch-review-enabled</code> is set to <code class="highlighter-rouge">false</code> any input names that match entries in the configured list will be treated as fatal errors.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">manual-review-domains = {</span>
  <span class="s">domain-list = [</span>
    <span class="s">"needs-review.*"</span>
  <span class="s">]</span>
  <span class="s">ip-list = [</span>
    <span class="s">"192.0.2.254",</span>
    <span class="s">"192.0.2.255",</span>
    <span class="s">"fd69:27cc:fe91:0:0:0:ffff:1",</span>
    <span class="s">"fd69:27cc:fe91:0:0:0:ffff:2"</span>
  <span class="s">]</span>
  <span class="s">zone-name-list = [</span>
    <span class="s">"zone.requires.review."</span>
  <span class="s">]</span>
<span class="err">}</span>
</code></pre>
</div>

<h3 id="scheduled-batch-changes-enabled">Scheduled Batch Changes Enabled</h3>
<p>Configuration setting that determines if users are able to make Batch Changes with a scheduled time. <code class="highlighter-rouge">manual-batch-review-enabled</code> must be enabled as well.
If enabled, a VinylDNS administrator cannot approve the Batch Change until after the scheduled time. An administrator could also reject the Batch Change.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">scheduled-changes-enabled = true</span>
</code></pre>
</div>

<h3 id="ipv6-zone-discovery-boundaries">IPv6 Zone Discovery Boundaries</h3>
<p>Configuration setting that determines the range that will be searched for in reverse IPv6 Zone Discovery. This allows you
to limit the search for what is appropriate for your organization. For example, min = 2, max = 3 will only search in
zones in the form <code class="highlighter-rouge">X.X.ip6.arpa.</code> and <code class="highlighter-rouge">X.X.X.ip6.arpa.</code>. Note the following constraints: 0 &lt; min &lt;= max &lt;= 32. If your
organization only makes zone cuts at one point, you may set min == max.</p>

<p>The default values if omitted are min = 5, max = 20.</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">v6-discovery-nibble-boundaries {</span>
  <span class="s">min = 5</span>
  <span class="s">max = 20</span>
<span class="err">}</span>

</code></pre>
</div>

<h3 id="full-example-config">Full Example Config</h3>
<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="c1"># The default application.conf is not intended to be used in production.  It assumes a docker-compose</span>
<span class="c1"># setup for all of the services.  Provide your own application.conf on the docker mount with your</span>
<span class="c1"># own settings</span>
<span class="s">vinyldns {</span>

  <span class="s">queue {</span>
    <span class="s">class-name = "vinyldns.sqs.queue.SqsMessageQueueProvider"</span>

    <span class="s">messages-per-poll = 10</span>
    <span class="s">polling-interval = 250.millis</span>

    <span class="s">settings {</span>
      <span class="s"># AWS access key and secret.</span>
      <span class="s">access-key = "x"</span>
      <span class="s">secret-key = "x"</span>

      <span class="s"># Regional endpoint to make your requests (eg. 'us-west-2', 'us-east-1', etc.). This is the region where your queue is housed.</span>
      <span class="s">signing-region = "x"</span>

      <span class="s"># Endpoint to access queue</span>
      <span class="s">service-endpoint = "http://localhost:9324/"</span>

      <span class="s"># Queue name. Should be used in conjunction with service endpoint, rather than using a queue url which is subject to change.</span>
      <span class="s">queue-name = "vinyldns"</span>
    <span class="s">}</span>
  <span class="s">}</span>

  <span class="s"># host and port the server binds to.  This should not be changed</span>
  <span class="s">rest {</span>
    <span class="s">host = "0.0.0.0"</span>
    <span class="s">port = 9000</span>
  <span class="s">}</span>
  
  <span class="s"># The maximum number of records VinylDNS will load when syncing a DNS Zone</span>
  <span class="s"># this is to prevent possible out of memory errors when loading a Zone</span>
  <span class="s"># this does not stop the zone from existing in DNS, but you will not be able to manage it in VinylDNS if the number of records exceeds the max</span>
  <span class="s">max-zone-size = 60000</span>

  <span class="s"># the delay between zone syncs so we are not syncing too often</span>
  <span class="s">sync-delay = 10000</span>

  <span class="s"># crypto settings for symmetric cryptography of secrets in the system</span>
  <span class="s"># Note</span><span class="pi">:</span> <span class="s">for production systems secrets should not live in plain text in a file</span>
  <span class="s">crypto {</span>
    <span class="s">type = "vinyldns.core.crypto.NoOpCrypto"</span>
  <span class="s">}</span>

  <span class="s"># both datastore options are in use</span>
  <span class="s">data-stores = ["mysql", "dynamodb"]</span>
  
  <span class="s">dynamodb {</span>
    <span class="s">class-name = "vinyldns.dynamodb.repository.DynamoDBDataStoreProvider"</span>
    
    <span class="s">settings {</span>
      <span class="s">key = "x"</span>
      <span class="s">secret = "x"</span>
      <span class="s">endpoint = "http://vinyldns-dynamodb:8000"</span>
      <span class="s">region = "us-east-1"</span>
    <span class="s">}</span>
    
    <span class="s">repositories {</span>
      <span class="s">record-change {</span>
        <span class="s">table-name = "recordChange"</span>
        <span class="s">provisioned-reads = 30</span>
        <span class="s">provisioned-writes = 20</span>
      <span class="s">}</span>
      <span class="s">zone-change {</span>
        <span class="s">table-name = "zoneChanges"</span>
        <span class="s">provisioned-reads = 30</span>
        <span class="s">provisioned-writes = 20</span>
      <span class="s">}</span>
      <span class="s">group {</span>
        <span class="s">table-name = "groups"</span>
        <span class="s">provisioned-reads = 30</span>
        <span class="s">provisioned-writes = 20</span>
      <span class="s">}</span>
      <span class="s">group-change {</span>
        <span class="s">table-name = "groupChanges"</span>
        <span class="s">provisioned-reads = 30</span>
        <span class="s">provisioned-writes = 20</span>
      <span class="s">}</span>
      <span class="s">membership {</span>
        <span class="s">table-name = "membership"</span>
        <span class="s">provisioned-reads = 30</span>
        <span class="s">provisioned-writes = 20</span>
      <span class="s">}</span>
    <span class="s">}</span>
  <span class="s">}</span>
  
  <span class="s">mysql {</span>
    <span class="s">class-name = "vinyldns.mysql.repository.MySqlDataStoreProvider"</span>
    
    <span class="s">settings {</span>
      <span class="s">name = "vinyldns"</span>
      <span class="s">driver = "org.mariadb.jdbc.Driver"</span>
      <span class="s">migration-url = "jdbc:mariadb://localhost:19002/?user=root&amp;password=pass"</span>
      <span class="s">url = "jdbc:mariadb://localhost:19002/vinyldns?user=root&amp;password=pass"</span>
      <span class="s">user = "root"</span>
      <span class="s">password = "pass"</span>
      <span class="s">maximum-pool-size = 20</span>
      <span class="s">minimum-idle = 10</span>
      <span class="s">connection-timeout-millis = 1000</span>
      <span class="s">idle-timeout = 10000</span>
      <span class="s">max-lifetime = 600000</span>
      <span class="s">register-mbeans = true</span>
      <span class="s">my-sql-properties {</span>
        <span class="s">prepStmtCacheSize = 300</span>
        <span class="s">prepStmtCacheSqlLimit = 2048</span>
        <span class="s">cachePrepStmts = true</span>
        <span class="s">useServerPrepStmts = true</span>
        <span class="s">rewriteBatchedStatements = true</span>
      <span class="s">}</span>
    <span class="s">}</span>
    
    <span class="s">repositories {</span>
      <span class="s">zone {</span>
      <span class="s">}</span>
      <span class="s">batch-change {</span>
      <span class="s">}</span>
      <span class="s">user {</span>
      <span class="s">}</span>
      <span class="s">record-set{</span>
      <span class="s">}</span>
    <span class="s">}</span>
  <span class="s">}</span>

  <span class="s"># the DDNS connection information for the default dns backend</span>
  <span class="s">defaultZoneConnection {</span>
    <span class="s">name = "vinyldns."</span>
    <span class="s">keyName = "vinyldns."</span>
    <span class="s">key = "nzisn+4G2ldMn0q1CV3vsg=="</span>
    <span class="s">primaryServer = "vinyldns-bind9"</span>
  <span class="s">}</span>

  <span class="s"># the AXFR connection information for the default dns backend</span>
  <span class="s">defaultTransferConnection {</span>
    <span class="s">name = "vinyldns."</span>
    <span class="s">keyName = "vinyldns."</span>
    <span class="s">key = "nzisn+4G2ldMn0q1CV3vsg=="</span>
    <span class="s">primaryServer = "vinyldns-bind9"</span>
  <span class="s">}</span>

  <span class="s"># the max number of changes in a single batch change.  Change carefully as this has performance</span>
  <span class="s"># implications</span>
  <span class="s">batch-change-limit = 1000</span>
  
  <span class="s"># notifier configuration</span>
  <span class="s">notifiers = ["email", "sns"]</span>

  <span class="s">email = {</span>
    <span class="s"># Path to notifier provider implementation</span>
    <span class="s">class-name = "vinyldns.api.notifier.email.EmailNotifierProvider"</span>
    
    <span class="s">settings = {</span>
      <span class="s"># Sender address for e-mail notifications</span>
      <span class="s">from = "Sender &lt;do-not-reply@example.sender&gt;"</span>
  
      <span class="s">smtp {</span>
        <span class="s"># Host SMTP server</span>
        <span class="s">host = "example.host"</span>
    <span class="s">}</span>
  <span class="s">}</span>

  <span class="s">sns {</span>
    <span class="s"># Path to notifier provider implementation</span>
    <span class="s">class-name = "vinyldns.api.notifier.sns.SnsNotifierProvider"</span>
    
    <span class="s">settings {</span>
      <span class="s"># SNS topic Amazon Resource Name (ARN)</span>
      <span class="s">topic-arn = "arn:aws:sns:us-east-1:000000000000:batchChanges"</span>
      
      <span class="s"># AWS access key and secret</span>
      <span class="s">access-key = "vinyldnsTest"</span>
      <span class="s">secret-key = "notNeededForSnsLocal"</span>
      
      <span class="s"># Endpoint to access SNS</span>
      <span class="s">service-endpoint = "http://127.0.0.1:19006"</span>
      
      <span class="s"># Regional endpoint to make your requests (eg. 'us-west-2', 'us-east-1', etc.). This is the region where your SNS is housed.</span>
      <span class="s">signing-region = "us-east-1"</span>
    <span class="s">}</span>
  <span class="s">}</span>

  <span class="s"># true if you want to enable manual review for non-fatal errors</span>
  <span class="s">manual-batch-review-enabled = true</span>
  
  <span class="s"># true if you want to allow Batch Changes to be scheduled.  manual-batch-review-enabled must also be true.</span>
  <span class="s">scheduled-changes-enabled = true</span>
  
  <span class="s"># types of unowned records that users can access in shared zones</span>
  <span class="s">shared-approved-types = ["A", "AAAA", "CNAME", "PTR", "TXT"]</span>
      
  <span class="s"># FQDNs / IPs that cannot be modified via VinylDNS</span>
  <span class="s"># regex-list</span><span class="pi">:</span> <span class="s">list of regular expressions matching any FQDN that are not allowed to be modified by this VinylDNS instance</span>
  <span class="s"># ip-list</span><span class="pi">:</span> <span class="s">list of IP addresses that cannot be modified by this VinylDNS instance</span>
  <span class="s">high-value-domains = {</span>
      <span class="s">regex-list = [</span>
        <span class="s">"high-value-domain.*"</span>
      <span class="s">ip-list = [</span>
        <span class="s">"192.0.2.252",</span>
        <span class="s">"192.0.2.253",</span>
        <span class="s">"fd69:27cc:fe91:0:0:0:0:ffff",</span>
        <span class="s">"fd69:27cc:fe91:0:0:0:ffff:0"</span>
      <span class="s">]</span>
  <span class="s">}</span>
  
  <span class="s"># FQDNS / IPs / zone names that require manual review when submitted through Batch Change/DNS Change</span>
  <span class="s"># Treated as a fatal error if manual review is not enabled</span>
  <span class="s">manual-review-domains = {</span>
    <span class="s">domain-list = [</span>
      <span class="s">"needs-review.*"</span>
    <span class="s">]</span>
    <span class="s">ip-list = [</span>
      <span class="s">"192.0.2.254",</span>
      <span class="s">"192.0.2.255",</span>
      <span class="s">"fd69:27cc:fe91:0:0:0:ffff:1",</span>
      <span class="s">"fd69:27cc:fe91:0:0:0:ffff:2"</span>
    <span class="s">]</span>
    <span class="s">zone-name-list = [</span>
      <span class="s">"zone.requires.review."</span>
    <span class="s">]</span>
  <span class="s">}</span>
  
  <span class="s"># Zone Connection Data</span>
  <span class="s">backends = [</span>
      <span class="s">{</span>
        <span class="s">id = "test-backend-id"</span>
        <span class="s">zone-connection {</span>
          <span class="s">name = "vinyldns."</span>
          <span class="s">key-name = "vinyldns."</span>
          <span class="s">key = "nzisn+4G2ldMn0q1CV3vsg=="</span>
          <span class="s">primary-server = "127.0.0.1:19001"</span>
        <span class="s">}</span>
        <span class="s">transfer-connection {</span>
          <span class="s">name = "vinyldns."</span>
          <span class="s">key-name = "vinyldns."</span>
          <span class="s">key = "nzisn+4G2ldMn0q1CV3vsg=="</span>
          <span class="s">primary-server = "127.0.0.1:19001"</span>
        <span class="s">}</span>
      <span class="s">}</span>
  <span class="s">]</span>

<span class="err">}</span>

<span class="c1"># Akka settings, these should not need to be modified unless you know akka http really well.</span>
<span class="s">akka {</span>
  <span class="s">loglevel = "INFO"</span>
  <span class="s">loggers = ["akka.event.slf4j.Slf4jLogger"]</span>
  <span class="s">logging-filter = "akka.event.slf4j.Slf4jLoggingFilter"</span>
  <span class="s">logger-startup-timeout = 30s</span>
<span class="err">}</span>

<span class="s">akka.http {</span>
  <span class="s">server {</span>
    <span class="s"># The time period within which the TCP binding process must be completed.</span>
    <span class="s"># Set to `infinite` to disable.</span>
    <span class="s">bind-timeout = 5s</span>

    <span class="s"># Show verbose error messages back to the client</span>
    <span class="s">verbose-error-messages = on</span>
  <span class="s">}</span>

  <span class="s">parsing {</span>
    <span class="s"># akka-http doesn't like the AWS4 headers</span>
    <span class="s">illegal-header-warnings = on</span>
  <span class="s">}</span>
<span class="err">}</span>
</code></pre>
</div>
</section><div class="edit-button"><a href="https://github.com/VinylDNS/vinyldns/edit/master/modules/docs/src/main/tut/operator/config-api.md" class="btn-sm btn-info">Improve this page</a></div></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script>((window.gitter = {}).chat = {}).options = {
room: 'vinyldns/Lobby'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/js/main.js"></script></body></html>